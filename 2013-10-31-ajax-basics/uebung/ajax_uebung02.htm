<!DOCTYPE html>
<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Ajax Tutorial</title>
        <link rel="stylesheet" type="text/css" href="u.css">
        <script>
            // [INHALT] wandelt den Response Text in ein JSON-Object um
            function formatResponseresponseTextToJSON(responseText) {
                var json
                try {
                    responseText = responseText.substring(
                        responseText.indexOf('(') + 1, 
                        responseText.lastIndexOf(')')
                    );
                    json = JSON && JSON.parse(responseText);
                } catch (e) {
                    alert("Parsing error:" + e);
                }
                return json;
            }


            var searchText = 'modern architecture'
            var pageId = 1;

            
            // lädt bilder über die flickr-api 
            function loadImages() {
                var requestURL = 'http://api.flickr.com/services/rest/' +
                    '?&method=flickr.photos.search' +
                    '&api_key=4ef2fe2affcdd6e13218f5ddd0e2500d' +
                    '&text=' + searchText +
                    '&page=' + pageId +
                    '&sort=relevance&per_page=5&format=json&jsoncallback=?';

                //initialisiert das AJAX-Objekt (Browser Check)
                var ajaxObject;
                
                /*** TODO
                *    ajaxObject abhängig von den verschiedenen Browser-Versionen intialisieren
                ***/

                // [STATUS] nach jeder Änderung der ajaxObject.readyState Variablen wird die Funktion ajaxObject.onreadystate aufgerufen  
                ajaxObject.onreadystatechange = function() {
                    
                    //wenn anfrage erfolgreich verarbeitet und daten zurückgesendet worden sind
                    if(/*** TODO : bei erfolgreicher anfrage ***/ ){
                        
                        
                        /*** TODO
                        *    responseText beinhaltet den String 
                        *    der von der Anfrage zurückgesendet wird
                        ***/
                        var responseText;

                        
                        //wandelt den String responseText in ein JSON-Object um
                        var json = formatResponseDataToJSON(responseText);

                        //Setze für jedes Photo die URL aus dem Daten zusammen
                        for (var i = 0; i < json.photos.photo.length; i++) {
                            var item = json.photos.photo[i];
                            var photoURL = 'http://farm' + item.farm + '.static.flickr.com/' + item.server + '/' + item.id + '_' + item.secret + '_m.jpg';
                            
                            var imgageElement = '<img src="' + photoURL + '">';
                            
                            /*** TODO :
                                Hier mit document.getElementById("id").innerHTML = "text"
                                die Bilder ins <div> element mit der Id container einfügen
                            ***/
                        }

                        // .children[0] von ID-Controls ist <input type="button" ... > 
                        document.getElementById("controls").children[0].removeAttribute("disabled");
                        document.getElementById("status").innerHTML = "Fertig geladen";
                    }

                    //wenn verbindung initialisiert wird
                    if (ajaxObject.readyState == 1) {
                        document.getElementById("controls").children[0].disabled = "disabled";
                        document.getElementById("status").innerHTML = "Lade...";
                    }
                }
                
                /*** TODO
                * Art der Anfrage festlegen
                ***/
                ajaxObject.send();
            }
        </script>
    </head>
    
    <body>
        <div id="container">
            <!-- HIER DIE BILDER REINLADEN -->
        </div>
        <div id="controls">
            <input type="button" value="Mehr Bilder" onClick="loadImages();" />
            <div id="status"></div>
        </div>
    </body>

</html>